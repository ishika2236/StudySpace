<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <title>Dashboard</title>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        body {
            background-color: #1a1a1a;
            color: #ffffff;
        }
        .dashboard-body {
            display: flex;
            padding: 1rem;
        }
        .dashboard-left {
            width: 70%;
            display: flex;
            flex-direction: column;
        }
        .dashboard-tasks {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
        }
        .curr-task {
            background-color: #292929;
            border-radius: 15px;
            padding: 1rem;
            width: 48%;
        }
        .task-list {
            background-color: #292929;
            border-radius: 15px;
            padding: 1rem;
            width: 48%;
        }
        .task-list-heading {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .db-task {
            background-color: #353535;
            border-radius: 10px;
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
        }
        .task-icon {
            margin-right: 1rem;
        }
        .task-details {
            flex-grow: 1;
        }
        .task-actions {
            display: flex;
        }
        .task-play-btn, .task-complete-btn {
            background: none;
            border: none;
            color: #ffffff;
            cursor: pointer;
            margin-left: 0.5rem;
        }
        .dashboard-meetings {
            background-color: #292929;
            border-radius: 15px;
            padding: 1rem;
            margin-top: 1rem;
        }
        .meetings-heading {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .list-meetings {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }
        .meetings {
            background-color: #353535;
            border-radius: 10px;
            padding: 1rem;
        }
    </style>
</head>
<body>
    <div class="dashboard-body">
        <div class="dashboard-left">
            <div class="dashboard-tasks">
                <div class="curr-task">
                    <h4 id="current-task-heading">No task running</h4>
                    <p id="current-task-project"></p>
                    <button class="task-play-btn" id="toggle-btn">
                        <i class="fas fa-play"></i>
                    </button>
                    <div class="time-btns">
                        <div class="time-elapsed"><p>Today</p><p id="time-elapsed">00:00:00</p></div>
                        <div class="time-limit"><p>Limits</p><p id="time-limit">00:00:00</p></div>
                    </div>
                </div>
                <div class="task-list">
                    <div class="task-list-heading">
                        <h4>Today's Tasks <span class="task-count" id="task-count">0</span></h4>
                        <div class="task-list-head-manage">Manage <i class="fa-solid fa-chevron-right"></i></div>
                    </div>
                    <div class="dashboard-tasklist" id="task-list-container">
                        <!-- Tasks will be populated here dynamically -->
                    </div>
                </div>
            </div>
            <div class="dashboard-meetings">
                <div class="meetings-heading">
                    <h4>Today's meetings</h4>
                    <a href="#">View all</a>
                </div>
                <div class="list-meetings">
                    <!-- Meetings will be populated here dynamically -->
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
            let assignments = JSON.parse(localStorage.getItem('assignments')) || [];
            let exams = JSON.parse(localStorage.getItem('exams')) || [];
            let currentlyPlayingTask = null;
            let timer = null;
           
            function updateTaskList() {
                const taskListContainer = document.getElementById('task-list-container');
                taskListContainer.innerHTML = '';
                const sortedTasks = tasks
                    .sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate))
                    .slice(0, 4);
                
                sortedTasks.forEach((task) => {
                    const taskElement = document.createElement('div');
                    taskElement.className = 'db-task';
                    taskElement.innerHTML = `
                        <div class="task-icon"><i class="fas fa-${task.status === 'active' ? 'play' : 'pause'}"></i></div>
                        <div class="task-details">
                            <div class="task-name"><h5>${task.title}</h5></div>
                            <div class="task-ref"><a href="">${task.project}</a></div>
                        </div>
                        <div class="task-actions">
                            <button class="task-play-btn" data-task-id="${task.id}"><i class="fas fa-play"></i></button>
                            <button class="task-complete-btn" data-task-id="${task.id}"><i class="fas fa-check"></i></button>
                        </div>
                    `;
                    taskListContainer.appendChild(taskElement);
                });
                
                document.getElementById('task-count').textContent = tasks.length;

                document.querySelectorAll('.task-play-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const taskId = parseInt(this.getAttribute('data-task-id'));
                        startTask(taskId);
                    });
                });

                document.querySelectorAll('.task-complete-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const taskId = parseInt(this.getAttribute('data-task-id'));
                        completeTask(taskId);
                    });
                });
            }

            function startTask(taskId) {
                if (currentlyPlayingTask) {
                    pauseTask();
                }
                currentlyPlayingTask = tasks.find(task => task.id === taskId);
                if (currentlyPlayingTask) {
                    currentlyPlayingTask.status = 'active';
                    localStorage.setItem('tasks', JSON.stringify(tasks)); // Save updated tasks
                    document.getElementById('current-task-heading').textContent = currentlyPlayingTask.title;
                    document.getElementById('current-task-project').textContent = currentlyPlayingTask.project;
                    document.getElementById('toggle-btn').innerHTML = '<i class="fas fa-pause"></i>';
                    startTimer();
                }
                updateTaskList();
            }

            function pauseTask() {
                if (currentlyPlayingTask) {
                    currentlyPlayingTask.status = 'inactive';
                    localStorage.setItem('tasks', JSON.stringify(tasks)); // Save updated tasks
                    stopTimer();
                    document.getElementById('toggle-btn').innerHTML = '<i class="fas fa-play"></i>';
                }
            }

            function completeTask(taskId) {
                const taskIndex = tasks.findIndex(task => task.id === taskId);
                if (taskIndex !== -1) {
                    tasks.splice(taskIndex, 1);
                    if (currentlyPlayingTask && currentlyPlayingTask.id === taskId) {
                        pauseTask();
                        currentlyPlayingTask = null;
                        document.getElementById('current-task-heading').textContent = 'No task running';
                        document.getElementById('current-task-project').textContent = '';
                    }
                    updateTaskList();
                }
            }

            function startTimer() {
                if (!currentlyPlayingTask.startTime) {
                    currentlyPlayingTask.startTime = new Date().getTime();
                }
                timer = setInterval(updateTimer, 1000);
            }

            function stopTimer() {
                clearInterval(timer);
                if (currentlyPlayingTask) {
                    currentlyPlayingTask.elapsedTime = (currentlyPlayingTask.elapsedTime || 0) + 
                        (new Date().getTime() - currentlyPlayingTask.startTime);
                    currentlyPlayingTask.startTime = null;
                }
            }

            function updateTimer() {
                if (currentlyPlayingTask) {
                    const elapsedTime = (currentlyPlayingTask.elapsedTime || 0) + 
                        (new Date().getTime() - currentlyPlayingTask.startTime);
                    const hours = Math.floor(elapsedTime / 3600000);
                    const minutes = Math.floor((elapsedTime % 3600000) / 60000);
                    const seconds = Math.floor((elapsedTime % 60000) / 1000);
                    document.getElementById('time-elapsed').textContent = 
                        `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }
            }

            document.getElementById('toggle-btn').addEventListener('click', function() {
                if (currentlyPlayingTask) {
                    if (this.querySelector('i').classList.contains('fa-pause')) {
                        pauseTask();
                    } else {
                        startTimer();
                        this.innerHTML = '<i class="fas fa-pause"></i>';
                    }
                }
            });

            updateTaskList();
        });
    </script>
</body>
</html>